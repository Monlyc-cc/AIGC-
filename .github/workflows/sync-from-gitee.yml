name: Sync from Gitee to GitHub

permissions:
  contents: write

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Prepare SSH for Gitee
        run: |
          mkdir -p ~/.ssh
          printf '%s\n' "${{ secrets.GITEE_SSH_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -H gitee.com >> ~/.ssh/known_hosts

      - name: Debug SSH to Gitee (safe)
        run: |
          chmod 600 ~/.ssh/id_rsa
          ssh -o BatchMode=yes -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa git@gitee.com || true
          git ls-remote git@gitee.com:mikoc/ziyan_-ai_fullstack.git || true

      - name: Clone Gitee repo (mirror)
        run: |
          git clone --mirror git@gitee.com:mikoc/ziyan_-ai_fullstack.git gitee-mirror
          ls -la gitee-mirror

      - name: Push mirror to GitHub via HTTPS (using PERSONAL PAT)
        env:
          GITHUB_REPO: Monlyc-cc/AIGC-
          GH_TOKEN: ${{ secrets.PERSONAL_GH_TOKEN }}
        run: |
          cd gitee-mirror
          git remote set-url --push origin https://x-access-token:${GH_TOKEN}@github.com/${GITHUB_REPO}.git
          git push --mirror origin